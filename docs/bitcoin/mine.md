# 挖矿

### 矿工的任务

（一类是验证交易和区块，一类是和其他矿工竞争）

一类是和其他矿工竞争

1. 监听交易广播

2. 维护区块链网络和监听新的区块

3. 组装一个备选区块

4. 找到新区块对应的有效的随机数

   先尝试头部的临时随机数，若试过所有32位可能的取值后仍然不能产生一个有效的哈希值，还可以改动币基里的随机数，但后者改动涉及到梅克尔树的更新，代价更大

   2015年目标区域值为：

   小于 0000000000000000172EC0000000000000000000000000000000000000000000

5. 新区块被全网接受
6. 获得利润



决定难度：每挖出2016个区块（约两周时间）则所有矿工自己重新计算一次难度

下一个难度 = 上一个难度 x 2016 x 10 / 产生上2016个区块所花费的分钟

 

### 挖矿所需硬件

挖矿设备：

1. CPU挖矿非常困难
2. GPU的高吞吐量和高并行处理能力更适合用于挖矿，且大多数显卡支持超频，能家加快运算速度；OpenCL是一个可以使GPU进行非图像处理类工作的通用语言；但是GPU内置了很多与挖矿无关的硬件，同时还有耗电多、散热难等问题；GPU挖矿的运算速度仍然 
3. 现场可编程门阵列挖矿（Field-Programmable Gate Array,FPGA）+Verilog（硬件设计语言），优点是比GPU性能好、容易冷却，缺点是性能提升不大、一直超频导致报错和故障、算法优化难、采购搭建难，故短暂存在后便退出舞台
4. 专用集成电路技术挖矿（ASIC），主导当今挖矿市场



大型专业挖矿中心，建立的三个重要因素：气候、电费、网络接入速度



新的另类币总会经历一个ASIC蜜月期（还没有ASIC的时期，个人参与挖矿的利润比较高）

 

### 能源消耗和生态环保

**蓝道尔原理（Landauer’s principle）**：任何一个不可逆转的计算都会消耗一定的能源

任何位移运算都会消耗一定量（kTln2）的焦耳

比特币的能源消耗：

1. 内涵能源：设备的制造和运输消耗的能源，会越来越小
2. 电能：根据蓝道尔原理，是不可避免的
3. 冷却：一般也是利用电力，寒冷环境可以减少消耗

 

比特币的能耗预估：

自上而下：将所有区块奖励的收入都用于电费来计算

自下而上：利用算力除以矿机功效来计算

得到比特币挖矿大搞所耗电力为几百万瓦特（MW）的数量级

 

### 矿池

总的发现区块的期望值可以是泊松概率分布

 

**矿池**：一组矿工形成一个矿池共同进行挖矿，并指定同一个币基接受人，最终无论谁发现了有效区块，币基接受人都根据每个参与者所贡献的工作量按比例分配奖励

**挖矿工分（mining shares）**：那些接近目标值的区块

**工分分红**：矿工发送工分后，管理员马上对其支付奖励；对矿工最有利，管理员需要承担风险但也会收取更高的管理费用；矿工没有动力追求有效区块

**按实际比例分红**：当找到一个有效区块时，将奖励按矿工的实际工作量比例分配；降低了管理员的风险但要求管理员校验、计算和分配奖励；矿工有动力追求有效区块；矿池足够大时，发现有效区块的概率波动会相当低

获取有效区块模板（getblocktemplate，GBT）作为一种标准化的矿池协议放进了比特币改进方案（Bitcoin Improvement Proposal，BIP）中。一种被称为层（stratum）在实际中运用广泛

**矿池跳换（pool hopping）**：矿工通过切换矿池的方式提高自己的收益。例如在挖矿周期的早期（上一个区块刚刚被发现），在按实际比例分红的矿池中挖矿，只在周期的后期切换到一个工分分红模式的矿池

**洗算力（laundering hashes）**：大的挖矿机构通过同时参与多个不同的矿池来掩盖他们的真实规模

 

### 挖矿的激励和策略

**挖矿策略**：

1. 需要包括哪些交易？默认选择交易费比较高的交易
2. 在哪一个区块上进行挖矿？默认是在最长的那条区块链上继续挖下去
3. 若两个不同的区块在同一时间被宣布发现，该如何做选择？默认选择最先被监听到的那个区块
4. 什么时候宣布新的区块？默认立刻宣布

大部分矿工都选择了默认策略（default strategy）来挖矿

 

### 挖矿攻击

**分叉攻击（forking attack）**：利用分叉制造双重支付

设一个攻击者矿工掌握的比特币网络挖掘市场份额为ａ，如果ａ>0.5，很可能实现一个分叉攻击，拥有近乎50%算力的攻击者可能需要花很长时间，但算力超过50%越多，攻击就会越容易且越有效

可操作的对策：大家可以觉察到攻击，社区可以对此做出决定，即使分叉链更长也可以拒绝接受

这种攻击能摧毁比特币信心，使其没有价值，可被称为金手指攻击（Goldfinger attack）；攻击者可以做比特币空头交易或拥有大量竞争货币而获益

 

**通过贿赂进行分叉攻击**：系统外的贿赂、高奖励矿池、高额交易费

 

**临时保留区块攻击（temporary block-whihholding attacks）**：找到有效区块后不立刻宣布而是在新区快上继续挖矿，期望可以在其他矿工找到下一个区块之前连续找到两个有效区块，该行为称为自私挖矿（selfish mining）

 

**惩罚分叉攻击（punitive forking）**：宣布拒绝在包含来自该地址的交易的区块链上工作，若宣布者市场运算能力大，则其他矿工会为了避免自己的区块链被分叉而不将该交易放入区块链中

 

**羽量级分叉攻击（feather forking）**：当算力不足0.5时，通过宣布将会尝试分叉来封杀某个地址，若其他矿工相信你，也可能会为了避免自己的区块链被分叉而决定加入你的封杀行动

 